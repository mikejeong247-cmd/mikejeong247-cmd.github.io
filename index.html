<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>í”„ë¡œ ì´ëª¨ì§€ ê²€ìƒ‰ â€” í•˜ì´ë¸Œë¦¬ë“œ(36ê°œ ì¦‰ì‹œ+ë”ë³´ê¸°)</title>

  <!-- ì„±ëŠ¥: í•„ìš”í•œ ì¶œì²˜ ì„ ì—°ê²° -->
  <link rel="preconnect" href="https://docs.google.com" crossorigin>
  <link rel="dns-prefetch" href="//docs.google.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <style>
    :root{
      --maxw: 1100px;
      --grid-width: 980px;
      --tile: 72px;
      --gap: 8px;
      --chip-h: 36px;
      --brand: #111;
      --border: #eee;
    }
    *{ box-sizing: border-box }
    html, body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple Color Emoji,Noto Color Emoji,sans-serif }

    /* ìƒë‹¨ */
    #toolbar{ position:sticky; top:0; z-index:10; background:#fff; border-bottom:1px solid var(--border) }
    #toolbar .in{ max-width:var(--maxw); margin:0 auto; padding:10px 12px; display:grid; gap:8px; grid-template-columns:1fr auto; align-items:center }
    #search{ height:40px; border:1px solid #ddd; border-radius:10px; padding:0 12px; font-size:15px }
    #copyBox{ display:flex; gap:8px; align-items:center }
    #copyOut{ width:180px; height:40px; border:1px solid #ddd; border-radius:10px; padding:0 12px; font-size:15px }
    #btnCopy{ height:40px; padding:0 14px; border:1px solid var(--brand); background:var(--brand); color:#fff; border-radius:10px; cursor:pointer }

    /* ì¹´í…Œê³ ë¦¬ ì¹© */
    #chipsWrap{ background:#fff; border-bottom:1px solid var(--border) }
    #chips{ max-width:var(--maxw); margin:0 auto; padding:8px 12px; display:grid; grid-auto-flow:column; grid-auto-columns:max-content; gap:8px; overflow-x:auto }
    .chip{ height:var(--chip-h); padding:0 12px; display:inline-grid; grid-auto-flow:column; gap:8px; align-items:center; border:1px solid #ddd; border-radius:999px; background:#fff; cursor:pointer; white-space:nowrap }
    .chip .emo{ font-size:18px; line-height:1 }
    .chip.active{ background:#f5f6ff; border-color:#d7dcff }

    /* ìƒíƒœ/í† ìŠ¤íŠ¸ */
    #status{ max-width:var(--maxw); margin:10px auto 0; padding:6px 12px; color:#555; text-align:center; display:none }
    #toast{ position:fixed; left:50%; bottom:22px; transform:translateX(-50%); z-index:20; background:rgba(0,0,0,.85); color:#fff; padding:8px 12px; border-radius:20px; font-size:14px; opacity:0; pointer-events:none; transition:opacity .18s }
    #toast.show{ opacity:1 }

    /* ê²€ìƒ‰ ê²°ê³¼ */
    #resultWrap{ max-width:var(--grid-width); margin:14px auto 0; padding:0 8px; display:none }
    #resultHead{ display:flex; justify-content:space-between; align-items:baseline; margin-bottom:8px }
    #resultGrid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(var(--tile),1fr)); gap:var(--gap) }

    /* ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ */
    .cat-section{ max-width:var(--grid-width); margin:18px auto 44px; padding:0 8px; content-visibility:auto; contain-intrinsic-size:1px 1200px }
    .cat-head{ display:flex; gap:10px; align-items:center; margin-bottom:8px }
    .cat-emo{ font-size:22px }
    .cat-title{ font-size:18px; font-weight:600 }
    .cat-count{ font-size:13px; color:#666; margin-left:auto }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(var(--tile),1fr)); gap:var(--gap) }
    .tile{ width:var(--tile); height:var(--tile); display:inline-flex; align-items:center; justify-content:center; border:1px solid var(--border); border-radius:10px; background:#fff; user-select:none; cursor:pointer; transition:transform .04s }
    .tile:hover{ transform:translateY(-1px); background:#fafafa }

    /* ìŠ¤ì¼ˆë ˆí†¤ */
    .skeleton{ background:linear-gradient(90deg,#f3f3f3 25%,#eaeaea 37%,#f3f3f3 63%); background-size:400% 100%; animation:shimmer 1.2s infinite; border:1px solid #eee; border-radius:10px }
    @keyframes shimmer{ 0%{background-position:100% 0} 100%{background-position:-100% 0} }

    .more{ margin-top:10px; text-align:center }
    .btn-more{ width:100%; height:42px; border:1px solid #ddd; background:#fff; border-radius:10px; cursor:pointer }
    .btn-more[disabled]{ opacity:.6; cursor:default }

    /* í‘¸í„° */
    #legal{ max-width:var(--maxw); margin:28px auto 40px; padding:0 12px; font-size:12px; color:#777 }
    #legal a{ color:inherit; text-decoration:underline }

    @media (max-width:768px){
      :root{ --grid-width:560px }
      #chips{ grid-auto-columns:max-content }
    }
  </style>

  <!-- Twemoji PNG íŒŒì„œ (SVG OFF) -->
  <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <!-- 1) ìƒë‹¨ -->
  <header id="toolbar">
    <div class="in">
      <input id="search" type="search" placeholder="ì´ëª¨ì§€ ì´ë¦„(name_*) / ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰ (í•œ ê¸€ìë„ ë§¤ì¹­)"/>
      <div id="copyBox">
        <input id="copyOut" type="text" readonly placeholder="ë³µì‚¬í•  ì´ëª¨ì§€"/>
        <button id="btnCopy" type="button">ë³µì‚¬</button>
      </div>
    </div>
  </header>

  <!-- 2) ì¹´í…Œê³ ë¦¬ ì¹© -->
  <div id="chipsWrap"><div id="chips"></div></div>

  <!-- 3) ìƒíƒœ/í† ìŠ¤íŠ¸ -->
  <div id="status"></div>
  <div id="toast">ë³µì‚¬ ì™„ë£Œ!</div>

  <!-- 4) ê²€ìƒ‰ ê²°ê³¼ -->
  <section id="resultWrap">
    <div id="resultHead"><div id="resultTitle">ê²€ìƒ‰ ê²°ê³¼</div><div id="resultCount"></div></div>
    <div id="resultGrid"></div>
  </section>

  <!-- 5) ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ì»¨í…Œì´ë„ˆ -->
  <div id="sections"></div>

  <!-- 6) ë²•ì  í‘œê¸° -->
  <footer id="legal">
    Emoji graphics by <a href="https://twemoji.twitter.com/" target="_blank" rel="noopener">Twemoji</a> Â© Twitter,
    licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">CC BY 4.0</a>. Unicode data Â© The Unicode Consortium.
  </footer>

  <!-- ğŸ”¹ ì¸ë¼ì¸ ì¦‰ì‹œ ë°ì´í„°: People & Body 36ê°œ (ì¦‰ì‹œ í˜ì¸íŠ¸ ë³´ì¥) -->
  <script type="application/json" id="INLINE_PEOPLE">[
    {"group":"People & Body","name_en":"person","name_ko":"ì‚¬ëŒ","emoji":"ğŸ§‘"},
    {"group":"People & Body","name_en":"man","name_ko":"ë‚¨ì","emoji":"ğŸ‘¨"},
    {"group":"People & Body","name_en":"woman","name_ko":"ì—¬ì","emoji":"ğŸ‘©"},
    {"group":"People & Body","name_en":"boy","name_ko":"ì†Œë…„","emoji":"ğŸ‘¦"},
    {"group":"People & Body","name_en":"girl","name_ko":"ì†Œë…€","emoji":"ğŸ‘§"},
    {"group":"People & Body","name_en":"baby","name_ko":"ì•„ê¸°","emoji":"ğŸ‘¶"},
    {"group":"People & Body","name_en":"old man","name_ko":"ë…¸ì¸(ë‚¨)","emoji":"ğŸ‘´"},
    {"group":"People & Body","name_en":"old woman","name_ko":"ë…¸ì¸(ì—¬)","emoji":"ğŸ‘µ"},
    {"group":"People & Body","name_en":"waving hand","name_ko":"ì† í”ë“¤ê¸°","emoji":"ğŸ‘‹"},
    {"group":"People & Body","name_en":"thumbs up","name_ko":"ë”°ë´‰","emoji":"ğŸ‘"},
    {"group":"People & Body","name_en":"thumbs down","name_ko":"ë”°ë´‰ ë°˜ëŒ€","emoji":"ğŸ‘"},
    {"group":"People & Body","name_en":"clapping hands","name_ko":"ë°•ìˆ˜","emoji":"ğŸ‘"},
    {"group":"People & Body","name_en":"raising hands","name_ko":"ë§Œì„¸","emoji":"ğŸ™Œ"},
    {"group":"People & Body","name_en":"folded hands","name_ko":"í•©ì¥","emoji":"ğŸ™"},
    {"group":"People & Body","name_en":"handshake","name_ko":"ì•…ìˆ˜","emoji":"ğŸ¤"},
    {"group":"People & Body","name_en":"victory hand","name_ko":"ë¸Œì´","emoji":"âœŒï¸"},
    {"group":"People & Body","name_en":"crossed fingers","name_ko":"í–‰ìš´","emoji":"ğŸ¤"},
    {"group":"People & Body","name_en":"OK hand","name_ko":"ì˜¤ì¼€ì´","emoji":"ğŸ‘Œ"},
    {"group":"People & Body","name_en":"call me hand","name_ko":"ì „í™”í•´","emoji":"ğŸ¤™"},
    {"group":"People & Body","name_en":"backhand index left","name_ko":"ì™¼ìª½ ê°€ë¦¬í‚´","emoji":"ğŸ‘ˆ"},
    {"group":"People & Body","name_en":"backhand index right","name_ko":"ì˜¤ë¥¸ìª½ ê°€ë¦¬í‚´","emoji":"ğŸ‘‰"},
    {"group":"People & Body","name_en":"backhand index up","name_ko":"ìœ„ ê°€ë¦¬í‚´","emoji":"ğŸ‘†"},
    {"group":"People & Body","name_en":"backhand index down","name_ko":"ì•„ë˜ ê°€ë¦¬í‚´","emoji":"ğŸ‘‡"},
    {"group":"People & Body","name_en":"raised hand","name_ko":"ì†ë°”ë‹¥","emoji":"âœ‹"},
    {"group":"People & Body","name_en":"raised back of hand","name_ko":"ì†ë“±","emoji":"ğŸ¤š"},
    {"group":"People & Body","name_en":"vulcan salute","name_ko":"ë²Œì»¨ ê²½ë¡€","emoji":"ğŸ––"},
    {"group":"People & Body","name_en":"sign of the horns","name_ko":"ë½","emoji":"ğŸ¤˜"},
    {"group":"People & Body","name_en":"love-you gesture","name_ko":"ì‚¬ë‘ ì œìŠ¤ì²˜","emoji":"ğŸ¤Ÿ"},
    {"group":"People & Body","name_en":"flexed biceps","name_ko":"í˜ìë‘","emoji":"ğŸ’ª"},
    {"group":"People & Body","name_en":"person walking","name_ko":"ê±·ëŠ” ì‚¬ëŒ","emoji":"ğŸš¶"},
    {"group":"People & Body","name_en":"person running","name_ko":"ë‹¬ë¦¬ê¸°","emoji":"ğŸƒ"},
    {"group":"People & Body","name_en":"person biking","name_ko":"ìì „ê±°","emoji":"ğŸš´"},
    {"group":"People & Body","name_en":"person swimming","name_ko":"ìˆ˜ì˜","emoji":"ğŸŠ"},
    {"group":"People & Body","name_en":"person raising hand","name_ko":"ì† ë“  ì‚¬ëŒ","emoji":"ğŸ™‹"},
    {"group":"People & Body","name_en":"person gesturing OK","name_ko":"ì˜¤ì¼€ì´ ì œìŠ¤ì²˜","emoji":"ğŸ™†"},
    {"group":"People & Body","name_en":"person gesturing NO","name_ko":"ë…¸ ì œìŠ¤ì²˜","emoji":"ğŸ™…"},
    {"group":"People & Body","name_en":"person bowing","name_ko":"ì¸ì‚¬","emoji":"ğŸ™‡"}
  ]</script>

  <script type="module">
    /* =========================================================
       ì„¤ì •
    ========================================================= */
    const DATA_URL = (location.pathname.replace(/[^/]+$/, '') || '/') + 'data/build.json'; // ê°™ì€ ë ˆí¬ì˜ ì •ì  ìŠ¤ëƒ…ìƒ·(ìˆìœ¼ë©´ ìµœìš°ì„ )
    const GSHEET = {
      id : '1-W_w24LxJGwqpsSW1B8pqCQGMWF_TV-Ip5L5XqDG68Q',
      gid: '1543598799',
      query: 'select *'
    };
    const INITIAL_PER_CAT = 36;      // ê° ì„¹ì…˜ ì²« ë…¸ì¶œ
    const MORE_CHUNK      = 240;     // ë”ë³´ê¸°ë‹¹ ì¦ê°€ëŸ‰

    const CAT_ORDER = [
      "Smileys & Emotion","People & Body","Animals & Nature","Food & Drink",
      "Travel & Places","Activities","Objects","Symbols","Flags"
    ];
    const LOCALE = (navigator.language||'en').toLowerCase().split('-')[0];
    const LABELS = {
      en: {"Smileys & Emotion":"Smileys & Emotion","People & Body":"People & Body","Animals & Nature":"Animals & Nature","Food & Drink":"Food & Drink","Travel & Places":"Travel & Places","Activities":"Activities","Objects":"Objects","Symbols":"Symbols","Flags":"Flags"},
      ko: {"Smileys & Emotion":"ìŠ¤ë§ˆì¼/ê°ì •","People & Body":"í”¼í”Œ/ë°”ë””","Animals & Nature":"ë™ë¬¼/ìì—°","Food & Drink":"ìŒì‹/ìŒë£Œ","Travel & Places":"ì—¬í–‰/ì¥ì†Œ","Activities":"í™œë™","Objects":"ì‚¬ë¬¼","Symbols":"ê¸°í˜¸","Flags":"êµ­ê¸°"},
      ja: {"Smileys & Emotion":"ã‚¹ãƒã‚¤ãƒ«/æ„Ÿæƒ…","People & Body":"äºº/ä½“","Animals & Nature":"å‹•ç‰©/è‡ªç„¶","Food & Drink":"é£Ÿã¹ç‰©/é£²ã¿ç‰©","Travel & Places":"æ—…è¡Œ/å ´æ‰€","Activities":"æ´»å‹•","Objects":"ç‰©","Symbols":"è¨˜å·","Flags":"æ——"},
      zh: {"Smileys & Emotion":"è¡¨æƒ…/æƒ…æ„Ÿ","People & Body":"äººç‰©/èº«ä½“","Animals & Nature":"åŠ¨ç‰©/è‡ªç„¶","Food & Drink":"é£Ÿç‰©/é¥®æ–™","Travel & Places":"æ—…è¡Œ/åœ°ç‚¹","Activities":"æ´»åŠ¨","Objects":"ç‰©å“","Symbols":"ç¬¦å·","Flags":"æ——å¸œ"}
    };
    const L10N = LABELS[LOCALE] || LABELS.en;

    /* =========================================================
       DOM
    ========================================================= */
    const UI = {
      search:   document.getElementById('search'),
      copyOut:  document.getElementById('copyOut'),
      btnCopy:  document.getElementById('btnCopy'),
      chips:    document.getElementById('chips'),
      sections: document.getElementById('sections'),
      status:   document.getElementById('status'),
      toast:    document.getElementById('toast'),
      resultWrap:  document.getElementById('resultWrap'),
      resultTitle: document.getElementById('resultTitle'),
      resultCount: document.getElementById('resultCount'),
      resultGrid:  document.getElementById('resultGrid'),
    };
    const showStatus=(m)=>{ UI.status.style.display='block'; UI.status.innerHTML=m; };
    const hideStatus=()=>{ UI.status.style.display='none'; UI.status.textContent=''; };
    const toast=(t="ë³µì‚¬ ì™„ë£Œ!")=>{ UI.toast.textContent=t; UI.toast.classList.add('show'); setTimeout(()=>UI.toast.classList.remove('show'),900); };

    const twParse = (el)=> window.twemoji?.parse(el,{ base:"https://cdn.jsdelivr.net/npm/twemoji@14.0.2/assets/", folder:"72x72", ext:".png" });

    /* =========================================================
       ìœ í‹¸
    ========================================================= */
    const lower = (s)=> String(s||'').toLowerCase();
    const codeToEmoji = (code)=>{ try{ return String.fromCodePoint(...String(code).split('-').map(h=>parseInt(h,16))); }catch(_){ return "â“"; } };
    const pick = (obj, keys)=>{ for(const k of keys){ if(obj[k]!=null && obj[k]!=='') return obj[k]; const k2=Object.keys(obj).find(x=>x.toLowerCase()===k.toLowerCase()); if(k2 && obj[k2]!=null && obj[k2]!=='') return obj[k2]; } return ''; };
    const slug = (s)=> String(s||'').toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,'');

    function fetchWithTimeout(url, ms=2500){
      return Promise.race([
        fetch(url,{cache:'no-cache'}),
        new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')), ms))
      ]);
    }
    function gsheetUrl(){
      const tq = encodeURIComponent(GSHEET.query || 'select *');
      return `https://docs.google.com/spreadsheets/d/${GSHEET.id}/gviz/tq?tqx=out:json&gid=${encodeURIComponent(GSHEET.gid)}&tq=${tq}`;
    }

    /* =========================================================
       ë°ì´í„° ì •ê·œí™”
       - ê²€ìƒ‰ì€ name_*ë§Œ ì‚¬ìš© (keywords ì™„ì „ ì œê±°)
    ========================================================= */
    function normalizeGeneric(root){
      // root: array or object with items/emojis/rows...
      const items = Array.isArray(root) ? root : (root.items||root.emojis||root.data||root.rows||[]);
      const out=[], seen=new Set();
      for(const r of items){
        if(!r) continue;
        const group = pick(r,['group','category','major','cat','section','type']);
        if(!group) continue;

        const code  = String(pick(r,['code','unified','unicode','codepoint'])||'').toUpperCase();
        const emoji = r.emoji || (code ? codeToEmoji(code) : '');
        if(!emoji) continue;

        // name_*ë§Œ í•©ì¹¨
        const name_local =
          (LOCALE==='ko' && pick(r,['name_ko','ko','name-korean'])) ||
          (LOCALE==='ja' && pick(r,['name_ja','ja'])) ||
          (LOCALE==='zh' && pick(r,['name_zh','zh'])) ||
          pick(r,['name','name_en','label','cldr','short_name','id']) || '';

        // name_* ì „ë¶€ë¥¼ í•©ì³ ê²€ìƒ‰ ë¬¸ìì—´ êµ¬ì„±
        const names = Object.keys(r).filter(k=>/^name(_|-)/i.test(k) || k==='name')
                       .map(k=>String(r[k]||''));
        const hay = names.join(' ').toLowerCase();

        const key = code || emoji; if(seen.has(key)) continue; seen.add(key);
        out.push({ group, name: name_local||pick(r,['name','name_en'])||'', nameAll: hay, emoji, code });
      }
      return out;
    }

    async function loadFromDataURL(){
      try{
        const res = await fetchWithTimeout(DATA_URL, 1500);
        if(!res.ok) return null;
        const j = await res.json();
        return normalizeGeneric(j);
      }catch(_){ return null; }
    }
    async function loadFromSheet(){
      try{
        const res = await fetchWithTimeout(gsheetUrl(), 3000);
        const text = await res.text();
        const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}')+1));
        const cols = (json.table.cols||[]).map(c=>c.label||c.id||'');
        const rows = (json.table.rows||[]).map(row=>{
          const obj={}; (row.c||[]).forEach((cell,i)=>{ obj[cols[i]||('col'+i)] = cell ? (cell.f ?? cell.v ?? '') : ''; });
          return obj;
        });
        return normalizeGeneric(rows);
      }catch(_){ return null; }
    }

    /* =========================================================
       ì „ì—­ ìƒíƒœ
    ========================================================= */
    let ALL=[], BY_CAT=new Map();      // ì¹´í…Œê³ ë¦¬ë³„ ì „ì²´
    let VIEW_BY_CAT=new Map();         // í™”ë©´ ë°˜ì˜(36ê°œ + ë”ë³´ê¸°)
    const CACHE_KEY='emoji_db_v1';     // ë¡œì»¬ ìºì‹œ

    function saveCache(arr){ try{ localStorage.setItem(CACHE_KEY, JSON.stringify(arr)); }catch(_){ } }
    function loadCache(){ try{ const raw=localStorage.getItem(CACHE_KEY); if(!raw) return null; const arr=JSON.parse(raw); return Array.isArray(arr)?arr:null; }catch(_){ return null; } }

    /* =========================================================
       ë Œë”: ì¹©/ì„¹ì…˜/íƒ€ì¼
    ========================================================= */
    const DEFAULT_EMO = {
      "Smileys & Emotion":"ğŸ˜€","People & Body":"ğŸ§‘","Animals & Nature":"ğŸ±","Food & Drink":"ğŸ”",
      "Travel & Places":"âœˆï¸","Activities":"âš½","Objects":"ğŸ’¡","Symbols":"â™¾","Flags":"ğŸ‡°ğŸ‡·"
    };

    function buildChips(cats){
      UI.chips.innerHTML='';
      const frag=document.createDocumentFragment();
      for(const cat of cats){
        const btn=document.createElement('button'); btn.className='chip'; btn.dataset.cat=cat;
        const emo=document.createElement('span'); emo.className='emo'; emo.textContent = (BY_CAT.get(cat)?.[0]?.emoji) || DEFAULT_EMO[cat] || 'ğŸ˜€';
        const lab=document.createElement('span'); lab.textContent = (L10N[cat] || cat);
        btn.append(emo,lab);
        btn.onclick=()=>{ document.getElementById(`sec-${slug(cat)}`)?.scrollIntoView({behavior:'smooth', block:'start'}); };
        frag.appendChild(btn);
      }
      UI.chips.appendChild(frag);
      UI.chips.querySelector('.chip')?.classList.add('active');
    }

    function sectionSkeleton(grid){
      grid.innerHTML='';
      const frag=document.createDocumentFragment();
      for(let i=0;i<INITIAL_PER_CAT;i++){
        const d=document.createElement('div'); d.className='tile skeleton';
        frag.appendChild(d);
      }
      grid.appendChild(frag);
    }

    function makeTile(it){
      const t=document.createElement('div'); t.className='tile'; t.title = it.name || it.code || ''; t.dataset.emoji=it.emoji;
      const span=document.createElement('span'); span.textContent=it.emoji; span.style.fontSize='40px';
      t.appendChild(span);
      t.onclick=()=>{ UI.copyOut.value=it.emoji; copyToClipboard(it.emoji); };
      return t;
    }

    function buildSections(cats){
      UI.sections.innerHTML='';
      const frag=document.createDocumentFragment();
      for(const cat of cats){
        const sec=document.createElement('section'); sec.className='cat-section'; sec.id=`sec-${slug(cat)}`; sec.dataset.cat=cat;

        const head=document.createElement('div'); head.className='cat-head';
        const emo=document.createElement('span'); emo.className='cat-emo'; emo.textContent=(BY_CAT.get(cat)?.[0]?.emoji)||DEFAULT_EMO[cat]||'ğŸ˜€';
        const title=document.createElement('div'); title.className='cat-title'; title.textContent=(L10N[cat]||cat);
        const count=document.createElement('div'); count.className='cat-count'; count.id=`count-${slug(cat)}`;

        const grid=document.createElement('div'); grid.className='grid'; grid.id=`grid-${slug(cat)}`;
        sectionSkeleton(grid); // ë°ì´í„° ì˜¤ê¸° ì „ ìŠ¤ì¼ˆë ˆí†¤

        const more=document.createElement('div'); more.className='more';
        const btn=document.createElement('button'); btn.className='btn-more'; btn.textContent='ë”ë³´ê¸°'; btn.id=`more-${slug(cat)}`;
        btn.onclick=()=>onMore(cat);
        more.appendChild(btn);

        head.append(emo,title,count);
        sec.append(head,grid,more);
        frag.appendChild(sec);

        // ì´ˆê¸° ë·° 36ê°œ ì„¸íŒ…(ë°ì´í„° ë“¤ì–´ì˜¤ë©´ ëŒ€ì²´)
        const list = BY_CAT.get(cat) || [];
        VIEW_BY_CAT.set(cat, list.slice(0, INITIAL_PER_CAT));
        updateSection(cat);
      }
      UI.sections.appendChild(frag);

      // ê°€ì‹œí™” ì‹œì ì—ë§Œ íŠ¸ì›Œëª¨ì§€ íŒŒì‹±
      const io=new IntersectionObserver((ents)=>{
        for(const e of ents){ if(e.isIntersecting){ twParse(e.target); io.unobserve(e.target); } }
      },{rootMargin:"600px"});
      document.querySelectorAll('.cat-section').forEach(sec=>io.observe(sec));
    }

    function updateSection(cat){
      const grid=document.getElementById(`grid-${slug(cat)}`); if(!grid) return;
      const list=VIEW_BY_CAT.get(cat)||[];
      if(list.length){
        grid.innerHTML='';
        const frag=document.createDocumentFragment();
        for(const it of list){ frag.appendChild(makeTile(it)); }
        grid.appendChild(frag);
      } // ì—†ìœ¼ë©´ ìŠ¤ì¼ˆë ˆí†¤ ìœ ì§€

      const total = BY_CAT.get(cat)?.length || 0;
      const moreBtn=document.getElementById(`more-${slug(cat)}`);
      document.getElementById(`count-${slug(cat)}`).textContent = total ? `${list.length}/${total}` : '';
      if(total && list.length < total){ moreBtn.style.display='block'; moreBtn.disabled=false; moreBtn.textContent='ë”ë³´ê¸°'; }
      else { moreBtn.style.display='none'; }
    }

    function onMore(cat){
      const list = BY_CAT.get(cat) || [];
      const cur  = VIEW_BY_CAT.get(cat) || [];
      if(!list.length) return;
      const next = list.slice(0, Math.min(cur.length + MORE_CHUNK, list.length));
      VIEW_BY_CAT.set(cat, next);
      updateSection(cat);
    }

    /* =========================================================
       ê²€ìƒ‰: name_* ì „ìš©(ë¶€ë¶„ ì¼ì¹˜, í•œ ê¸€ì ë§¤ì¹­)
    ========================================================= */
    function onSearch(){
      const q = lower(UI.search.value);
      if(!q){
        UI.resultWrap.style.display='none';
        document.querySelectorAll('.cat-section').forEach(s=>s.style.display='block');
        return;
      }
      const hits=[];
      for(const arr of BY_CAT.values()){
        for(const it of arr){
          if( (it.nameAll||'').includes(q) ) hits.push(it);
        }
      }
      UI.resultTitle.textContent='ê²€ìƒ‰ ê²°ê³¼';
      UI.resultCount.textContent = `${hits.length.toLocaleString()}ê°œ`;
      UI.resultGrid.innerHTML='';
      const frag=document.createDocumentFragment();
      for(const it of hits){ frag.appendChild(makeTile(it)); }
      UI.resultGrid.appendChild(frag);
      UI.resultWrap.style.display='block';
      document.querySelectorAll('.cat-section').forEach(s=>s.style.display='none');
      twParse(UI.resultGrid);
    }

    /* =========================================================
       ë°ì´í„° â†’ ì¹´í…Œê³ ë¦¬ ë§µ ê°±ì‹ 
    ========================================================= */
    function rebuildFromALL(){
      BY_CAT.clear();
      // í‘œì¤€ ì¹´í…Œê³ ë¦¬ ìˆœì„œ(ì¹©/ì„¹ì…˜ì€ í•­ìƒ ë…¸ì¶œ)
      for(const cat of CAT_ORDER) BY_CAT.set(cat, []);
      for(const it of ALL){
        const c = BY_CAT.has(it.group) ? it.group : it.group; // ëª¨ë¥´ëŠ” ê·¸ë£¹ë„ í—ˆìš©
        if(!BY_CAT.has(c)) BY_CAT.set(c, []);
        BY_CAT.get(c).push(it);
      }
      // ì •ë ¬
      for(const [k,arr] of BY_CAT.entries()){
        arr.sort((a,b)=> (a.name||'').localeCompare((b.name||''), LOCALE));
      }
      const cats = [...BY_CAT.keys()].sort((a,b)=>(CAT_ORDER.indexOf(a)===-1?999:CAT_ORDER.indexOf(a))-(CAT_ORDER.indexOf(b)===-1?999:CAT_ORDER.indexOf(b)));

      buildChips(cats);
      buildSections(cats);
      hideStatus();
    }

    /* =========================================================
       ë¶€íŠ¸ìŠ¤íŠ¸ë© (Inline â–¶ Data URL â–¶ Sheet)
    ========================================================= */
    async function copyToClipboard(text){
      try{ await navigator.clipboard.writeText(text); toast(); }
      catch(_){ UI.copyOut.value=text; UI.copyOut.select(); document.execCommand('copy'); toast(); }
    }
    UI.btnCopy.addEventListener('click', ()=>{ const v=UI.copyOut.value||''; if(v) copyToClipboard(v); });
    UI.search.addEventListener('input', onSearch);

    (async function boot(){
      showStatus('ì´ˆê¸°í™”â€¦');

      // (A) í‘œì¤€ ì¹´í…Œê³ ë¦¬ë¡œ ì¹©/ì„¹ì…˜ ë¼ˆëŒ€ ì¦‰ì‹œ ìƒì„±(ìŠ¤ì¼ˆë ˆí†¤ ë³´ì„)
      rebuildFromALL(); // ALLì´ ë¹„ì–´ìˆì–´ë„ ì„¹ì…˜/ì¹© ìƒì„±ë¨

      // (B) ì¸ë¼ì¸ 36ê°œ â†’ ì¦‰ì‹œ ì±„ì›€ (People & Body)
      try{
        const inline = JSON.parse(document.getElementById('INLINE_PEOPLE').textContent||'[]');
        const norm = normalizeGeneric(inline);
        if(norm.length){
          // ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ëŠ” ì•„ì§ ìŠ¤ì¼ˆë ˆí†¤, í”¼í”Œ/ë°”ë””ëŠ” ì¦‰ì‹œ ë°˜ì˜
          ALL = ALL.concat(norm);
          rebuildFromALL();
        }
      }catch(_){}

      // (C) Data URL ìŠ¤ëƒ…ìƒ· ì‹œë„(ê°€ì¥ ë¹ ë¦„)
      const fromData = await loadFromDataURL();
      if(fromData && fromData.length){
        ALL = fromData;
        saveCache(ALL);
        rebuildFromALL();
      }else{
        // (D) Sheet(gviz) ì‹œë„(ìµœì‹ ì„±)
        const fromSheet = await loadFromSheet();
        if(fromSheet && fromSheet.length){
          ALL = fromSheet;
          saveCache(ALL);
          rebuildFromALL();
        }else{
          // (E) ìºì‹œë¼ë„ ìˆìœ¼ë©´ ì‚¬ìš©
          const cached = loadCache();
          if(cached && cached.length){
            ALL = cached; rebuildFromALL();
          }else{
            // ì•„ë¬´ ê²ƒë„ ì—†ì–´ë„ People 36ê°œëŠ” ì´ë¯¸ ë³´ì´ëŠ” ìƒíƒœ
            showStatus('ì™¸ë¶€ ë°ì´í„° ì—†ìŒ â€” ì¸ë¼ì¸ ë°ì´í„°ë¡œ í‘œì‹œ ì¤‘');
            setTimeout(hideStatus, 1200);
          }
        }
      }
    })();
  </script>
</body>
</html>
