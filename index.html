<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÌîÑÎ°ú Ïù¥Î™®ÏßÄ Í≤ÄÏÉâ ‚Äî Ï†ÑÏ≤¥ Î≥¥Í∏∞(Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÎã®)</title>
  <meta name="description" content="Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÎã®ÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú Ï†ÑÏ≤¥ Ïù¥Î™®ÏßÄÎ•º Îπ†Î•¥Í≤å ÌëúÏãú. name_*ÎßåÏúºÎ°ú Í≤ÄÏÉâ." />
  <style>
    :root{
      --grid-width: 520px;     /* Ï¥àÍ∏∞ LCP ÏµúÏÜåÌôî */
      --tile-size: 72px;
      --gap: 8px;
      --cat-table-maxw: 1100px;
      --cat-cell-h: 48px;
      --cat-font: 15px;
    }
    *{ box-sizing: border-box; }
    html, body{ margin:0; padding:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple Color Emoji,Noto Color Emoji,sans-serif; }
    /* ÏÉÅÎã®: Í≤ÄÏÉâ + Î≥µÏÇ¨ */
    #toolbar{ position: sticky; top: 0; z-index: 9; background:#fff; border-bottom:1px solid #eee; backdrop-filter: blur(4px); }
    #toolbar .inner{ max-width: var(--cat-table-maxw); margin:0 auto; padding:10px 12px; display:grid; gap:8px; grid-template-columns: 1fr auto; align-items:center; }
    #search{ width:100%; height:40px; border:1px solid #ddd; border-radius:8px; padding:0 12px; font-size:15px; }
    #copyBox{ display:flex; gap:8px; align-items:center; }
    #copyOut{ width:160px; height:40px; border:1px solid #ddd; border-radius:8px; padding:0 12px; font-size:16px; }
    #btnCopy{ height:40px; padding:0 14px; border:1px solid #333; background:#111; color:#fff; border-radius:8px; cursor:pointer; }
    /* Ïπ¥ÌÖåÍ≥†Î¶¨ Ìëú */
    #catTableWrap{ position: sticky; top: 60px; z-index: 8; background:#fff; border-bottom:1px solid #eee; }
    #catTableWrap .inner{ max-width: var(--cat-table-maxw); margin:0 auto; padding:8px 12px; }
    table.cat-table{ width:100%; table-layout:fixed; border-collapse:collapse; font-size:var(--cat-font); }
    table.cat-table td{ padding:0; border:1px solid #f1f1f1; }
    .cat-btn{ width:100%; height:var(--cat-cell-h); display:grid; grid-template-columns:28px 1fr; align-items:center; gap:8px; padding:8px 10px; border:0; background:#fff; cursor:pointer; }
    .cat-btn:hover{ background:#fafafa; }
    .cat-btn.active{ outline:2px solid rgba(0,0,0,.08); background:#f9f9ff; }
    .cat-emoji{ width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center; font-size:20px; line-height:1; }
    .cat-label{ overflow:hidden; white-space:nowrap; text-overflow:ellipsis; text-align:left; }
    /* Í∑∏Î¶¨Îìú */
    #gridWrap{ max-width:var(--grid-width); margin:12px auto 60px; padding:0 8px; }
    #grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(var(--tile-size), 1fr)); gap:var(--gap); align-items:start; }
    .tile{ width:var(--tile-size); height:var(--tile-size); display:inline-flex; align-items:center; justify-content:center; border-radius:10px; border:1px solid #eee; background:#fff; cursor:pointer; user-select:none; transition:transform .04s ease; }
    .tile:hover{ transform:translateY(-1px); background:#fafafa; }
    .tile img{ width:var(--tile-size); height:var(--tile-size); image-rendering:-webkit-optimize-contrast; }
    /* ÌÜ†Ïä§Ìä∏/ÏÉÅÌÉú */
    #toast{ position:fixed; left:50%; bottom:24px; transform:translateX(-50%); z-index:20; background:rgba(0,0,0,.8); color:#fff; padding:8px 12px; border-radius:20px; font-size:14px; opacity:0; pointer-events:none; transition:opacity .2s ease; }
    #toast.show{ opacity:1; }
    #status{ max-width:720px; margin:20px auto; padding:12px; color:#444; text-align:center; display:none; }
    @media (max-width: 720px){
      :root{ --cat-font:14px; }
      #toolbar .inner{ grid-template-columns: 1fr; }
      #catTableWrap{ top:112px; }
    }
  </style>
  <!-- Twemoji (PNG Í∞ïÏ†ú, SVG OFF) -->
  <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <!-- ÏÉÅÎã®: Í≤ÄÏÉâ + Î≥µÏÇ¨ -->
  <header id="toolbar">
    <div class="inner">
      <input id="search" type="search" placeholder="Ïù¥Î™®ÏßÄ Ïù¥Î¶Ñ(name_*)ÏúºÎ°ú Í≤ÄÏÉâ (Ï†ÑÏ≤¥/Ïπ¥ÌÖåÍ≥†Î¶¨ ÎÇ¥)" />
      <div id="copyBox">
        <input id="copyOut" type="text" readonly placeholder="Î≥µÏÇ¨Ìï† Ïù¥Î™®ÏßÄ" />
        <button id="btnCopy" type="button">Î≥µÏÇ¨</button>
      </div>
    </div>
  </header>

  <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Ìëú -->
  <section id="catTableWrap">
    <div class="inner">
      <table class="cat-table" id="catTable"><tbody id="catTbody"></tbody></table>
    </div>
  </section>

  <!-- ÏÉÅÌÉú/Í∑∏Î¶¨Îìú/ÌÜ†Ïä§Ìä∏ -->
  <div id="status"></div>
  <main id="gridWrap"><section id="grid"></section></main>
  <div id="toast">Î≥µÏÇ¨ ÏôÑÎ£å!</div>

  <script type="module">
    /* === ÏÉÅÏàò === */
    const DATA_BASE = (location.pathname.split('/').filter(Boolean).length ? `/${location.pathname.split('/')[0]}/data/` : '/data/');
    const SPRITES_BASE = (location.pathname.split('/').filter(Boolean).length ? `/${location.pathname.split('/')[0]}/sprites/` : '/sprites/');
    const ALL_KEY='__ALL__', ALL_LABEL='Ï†ÑÏ≤¥', ALL_ICON='‚≠ê';
    const FIRST_CHUNK=240, NEXT_CHUNK=240;

    /* === UI === */
    const UI = {
      search: document.getElementById('search'),
      copyOut: document.getElementById('copyOut'),
      btnCopy: document.getElementById('btnCopy'),
      status: document.getElementById('status'),
      grid: document.getElementById('grid'),
      catTbody: document.getElementById('catTbody'),
      toast: document.getElementById('toast'),
    };
    const showStatus=(m)=>{ UI.status.style.display='block'; UI.status.textContent=m; };
    const hideStatus=()=>{ UI.status.style.display='none'; UI.status.textContent=''; };
    const showToast=(t="Î≥µÏÇ¨ ÏôÑÎ£å!")=>{ UI.toast.textContent=t; UI.toast.classList.add('show'); setTimeout(()=>UI.toast.classList.remove('show'),900); };
    const ensureTwemoji = (el)=> window.twemoji?.parse(el,{ base:"https://cdn.jsdelivr.net/npm/twemoji@14.0.2/assets/", folder:"72x72", ext:".png" });

    /* === ÏÉÅÌÉú === */
    let BUILD=null, SPRITE_MAP=null, SUPPORT_HINTS=null;
    let ALL_ITEMS=[], CAT_MAP=null, ACTIVE_CAT=ALL_KEY, BASE_LIST=[], VIEW_LIST=[];
    const koLabelMap={"Smileys & Emotion":"Ïä§ÎßàÏùº/Í∞êÏ†ï","People & Body":"ÌîºÌîå/Î∞îÎîî","Animals & Nature":"ÎèôÎ¨º/ÏûêÏó∞","Food & Drink":"ÏùåÏãù/ÏùåÎ£å","Travel & Places":"Ïó¨Ìñâ/Ïû•ÏÜå","Activities":"ÌôúÎèô","Objects":"ÏÇ¨Î¨º","Symbols":"Í∏∞Ìò∏","Flags":"Íµ≠Í∏∞"};
    const pickLabel=(raw)=>koLabelMap[raw]||raw||"Í∏∞ÌÉÄ";
    const codeToEmoji=(code)=>{ try{ return String.fromCodePoint(...String(code).split('-').map(h=>parseInt(h,16))); }catch(_){ return "‚ùì"; } };
    const pick=(obj,keys)=>{ for(const k of keys){ if(obj[k]!=null&&obj[k]!=='') return obj[k]; const k2=Object.keys(obj).find(x=>x.toLowerCase()===k.toLowerCase()); if(k2&&obj[k2]!=null&&obj[k2]!=='') return obj[k2]; } return ''; };

    /* === 1) Îç∞Ïù¥ÌÑ∞ Î°úÎìú (ÎèôÏùº ÎèÑÎ©îÏù∏ Í≥†Ï†ï) + ÏùëÍ∏â ÎÇ¥Ïû• Îç∞Ïù¥ÌÑ∞ === */
    async function fetchJSON(u){ try{ const r=await fetch(u,{cache:"no-cache"}); if(r.ok) return await r.json(); }catch(_){ } return null; }
    function emergencySample(){
      // ÏùëÍ∏â Î™®Îìú: ÏµúÏÜå 60Í∞ú ÏÉòÌîå(Ïπ¥ÌÖåÍ≥†Î¶¨ Í∑†Ìòï) ‚Äî Îπà ÌôîÎ©¥ Î∞©ÏßÄ
      const s=(g,n,c)=>({group:g,name:n,nameText:n.toLowerCase(),code:c,emoji:codeToEmoji(c)});
      const A=[
        s("Smileys & Emotion","grinning face","1F600"), s("Smileys & Emotion","smiling face with smiling eyes","1F60A"),
        s("Smileys & Emotion","face with tears of joy","1F602"), s("Smileys & Emotion","smiling face with heart-eyes","1F60D"),
        s("People & Body","person","1F9D1"), s("People & Body","man","1F468"), s("People & Body","woman","1F469"), s("People & Body","person running","1F3C3"),
        s("Animals & Nature","cat face","1F431"), s("Animals & Nature","dog face","1F436"), s("Animals & Nature","seedling","1F331"), s("Animals & Nature","sun","2600"),
        s("Food & Drink","hamburger","1F354"), s("Food & Drink","pizza","1F355"), s("Food & Drink","hot beverage","2615"), s("Food & Drink","bento box","1F371"),
        s("Activities","soccer ball","26BD"), s("Activities","basketball","1F3C0"), s("Activities","video game","1F3AE"), s("Activities","trophy","1F3C6"),
        s("Objects","mobile phone","1F4F1"), s("Objects","laptop","1F4BB"), s("Objects","camera","1F4F7"), s("Objects","gem stone","1F48E"),
        s("Symbols","check mark","2714"), s("Symbols","cross mark","274C"), s("Symbols","sparkles","2728"), s("Symbols","heart","2764"),
        s("Travel & Places","airplane","2708"), s("Travel & Places","automobile","1F697"), s("Travel & Places","house","1F3E0"), s("Travel & Places","mountain","26F0"),
        s("Flags","chequered flag","1F3C1"), s("Flags","triangular flag","1F6A9"), s("Flags","Korea (flag)","1F1F0-1F1F7"), s("Flags","United States (flag)","1F1FA-1F1F8")
      ];
      // 60Í∞ú Ï±ÑÏö∞Í∏∞ ÏúÑÌï¥ Î∞òÎ≥µ
      while(A.length<60){ A.push({...A[A.length%32]}); }
      return A;
    }
    async function loadData(){
      const buildUrl  = DATA_BASE + "build.json";
      const spriteUrl = SPRITES_BASE + "SPRITE_MAP.json";
      const hintsUrl  = SPRITES_BASE + "SUPPORT_HINTS.json";
      BUILD = await fetchJSON(buildUrl);
      SPRITE_MAP = await fetchJSON(spriteUrl);
      SUPPORT_HINTS = await fetchJSON(hintsUrl);
      if(!BUILD){
        // ÏùëÍ∏â Î™®Îìú Í∞ÄÎèô
        showStatus("ÏùëÍ∏â Î™®Îìú: /data/build.jsonÏù¥ ÏóÜÏñ¥ ÎÇ¥Ïû• ÏÉòÌîåÎ°ú ÌëúÏãú Ï§ëÏûÖÎãàÎã§. (ActionsÎ°ú build.json ÏÉùÏÑ±ÎêòÎ©¥ ÏûêÎèô Ï†ÑÌôò)");
        ALL_ITEMS = emergencySample();
        CAT_MAP = buildCatMap(ALL_ITEMS);
        buildCategoryTable(CAT_MAP);
        setActiveCategory(ALL_KEY);
        return false; // ÏïåÎ¶ºÏö©
      }
      hideStatus();
      return true;
    }

    /* === 2) Ï†ïÍ∑úÌôî(name_*Îßå Í≤ÄÏÉâ) === */
    function normalizeItems(root){
      const out=[]; const seen=new Set();
      function walk(node, inheritedCat=''){
        if(!node) return;
        if(Array.isArray(node)){ for(const v of node) walk(v, inheritedCat); return; }
        if(typeof node!=='object') return;
        const groupCat = pick(node, ['group','category','major','cat','section','type']) || inheritedCat;
        if (Array.isArray(node.items)) { for(const v of node.items) walk(v, groupCat); }
        const code = pick(node, ['code','hex','u','unified','unicode','codepoint','cp']);
        const emojiChar = node.emoji || (code ? codeToEmoji(code) : '');
        if (emojiChar || code){
          const key=(code||emojiChar);
          if(!seen.has(key)){
            seen.add(key);
            const nameFields = Object.keys(node).filter(k=>/^name[_-]/i.test(k)||k==='name');
            const names = nameFields.map(k=>String(node[k])).filter(Boolean);
            const primaryName =
              pick(node, ['name_ko','name_kr','name_korean','name']) ||
              pick(node, ['name_en','label','cldr','short_name','id']) || '';
            out.push({
              group: groupCat || pick(node, ['group','category','major','cat']),
              name: primaryName,
              nameText: [primaryName, ...names].join(' ').trim().toLowerCase(),
              code: (code||'').toUpperCase(),
              emoji: emojiChar,
              png: pick(node, ['png','pngUrl','url','image','img'])
            });
          }
        }else{
          for(const v of Object.values(node)) if(v && typeof v==='object') walk(v, groupCat);
        }
      }
      walk(root,'');
      return out;
    }
    function buildCatMap(items){
      const m=new Map();
      for(const it of items){
        const cat=it.group||'Í∏∞ÌÉÄ';
        if(!m.has(cat)) m.set(cat,[]);
        m.get(cat).push(it);
      }
      return m;
    }

    /* === 3) Ïπ¥ÌÖåÍ≥†Î¶¨ Ìëú === */
    function buildCategoryTable(catMap){
      const tbody = UI.catTbody; tbody.innerHTML="";
      const ordered=["Smileys & Emotion","People & Body","Animals & Nature","Food & Drink","Travel & Places","Activities","Objects","Symbols","Flags"];
      const cats=[...catMap.keys()].sort((a,b)=>(ordered.indexOf(a)===-1?999:ordered.indexOf(a))-(ordered.indexOf(b)===-1?999:ordered.indexOf(b)));
      const final=[ALL_LABEL,...cats];
      const columns=(window.innerWidth<=720)?3:5;
      for(let i=0;i<final.length;i+=columns){
        const tr=document.createElement("tr");
        for(const cat of final.slice(i,i+columns)){
          const td=document.createElement("td");
          const btn=document.createElement("button");
          btn.className="cat-btn";
          btn.setAttribute("data-cat", cat===ALL_LABEL?ALL_KEY:cat);
          const em=document.createElement("span");
          em.className="cat-emoji";
          if(cat===ALL_LABEL) em.textContent=ALL_ICON;
          else{ const sample=(catMap.get(cat)||[])[0]; em.textContent= sample?.emoji || "üòÄ"; }
          const label=document.createElement("span");
          label.className="cat-label"; label.textContent= cat===ALL_LABEL?ALL_LABEL:pickLabel(cat);
          btn.appendChild(em); btn.appendChild(label); td.appendChild(btn); tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      ensureTwemoji(tbody);
      tbody.addEventListener("click",(e)=>{
        const btn=e.target.closest(".cat-btn"); if(!btn) return;
        setActiveCategory(btn.getAttribute("data-cat"));
      });
    }

    /* === 4) Î†åÎçîÎü¨ === */
    function hasSprite(it){ return SPRITE_MAP && (SPRITE_MAP[it.code] || (SPRITE_MAP.sprites && SPRITE_MAP.sprites[it.code])); }
    function spriteRec(it){ return (SPRITE_MAP && (SPRITE_MAP[it.code] || (SPRITE_MAP.sprites && SPRITE_MAP.sprites[it.code]))) || null; }
    function makeTile(it){
      const tile=document.createElement("div"); tile.className="tile"; tile.title=it.name||it.code||"";
      if(hasSprite(it)){
        const rec=spriteRec(it);
        const sheet=(rec.sheet||rec.s||rec.sprite||"emoji-top500-1.webp");
        const bx=-(rec.x||rec.left||0), by=-(rec.y||rec.top||0);
        const bw=rec.w||rec.width||72, bh=rec.h||rec.height||72;
        tile.style.backgroundImage=`url(${SPRITES_BASE}${sheet})`;
        tile.style.backgroundPosition=`${bx}px ${by}px`;
        tile.style.backgroundRepeat="no-repeat";
        tile.style.width=bw+"px"; tile.style.height=bh+"px";
        tile.dataset.emoji=it.emoji; return tile;
      }
      if(it.png && !(SUPPORT_HINTS?.block?.includes(it.code))){
        const img=document.createElement("img"); img.loading="lazy"; img.decoding="async";
        img.src=it.png; img.alt=it.name||it.code||""; tile.appendChild(img);
        tile.dataset.emoji=it.emoji; return tile;
      }
      const span=document.createElement("span"); span.textContent=it.emoji||"‚ùì"; span.style.fontSize="40px";
      tile.appendChild(span); setTimeout(()=>ensureTwemoji(tile),0);
      tile.dataset.emoji=it.emoji||""; return tile;
    }
    function renderList(list){
      UI.grid.innerHTML=""; let idx=0;
      const first=list.slice(0,FIRST_CHUNK); const f1=document.createDocumentFragment();
      for(const it of first) f1.appendChild(makeTile(it));
      UI.grid.appendChild(f1); idx=FIRST_CHUNK;
      const sentinel=document.createElement("div"); UI.grid.appendChild(sentinel);
      const io=new IntersectionObserver((ents)=>{
        const seen=ents.some(e=>e.isIntersecting); if(!seen) return;
        if(idx>=list.length){ io.disconnect(); return; }
        const part=list.slice(idx,idx+NEXT_CHUNK); const frag=document.createDocumentFragment();
        for(const it of part) frag.appendChild(makeTile(it));
        UI.grid.insertBefore(frag,sentinel); idx+=NEXT_CHUNK;
      },{rootMargin:"900px"});
      io.observe(sentinel);
    }

    /* === 5) Ïπ¥ÌÖåÍ≥†Î¶¨/Í≤ÄÏÉâ === */
    function setActiveCategory(key){
      ACTIVE_CAT=key;
      document.querySelectorAll(".cat-btn").forEach(b=>b.classList.toggle("active", b.getAttribute("data-cat")===key));
      BASE_LIST = (key===ALL_KEY) ? ALL_ITEMS : (CAT_MAP.get(key) || []);
      applySearch();
    }
    function applySearch(){
      const q=UI.search.value.trim().toLowerCase();
      VIEW_LIST = !q ? BASE_LIST : BASE_LIST.filter(it=> (it.nameText || it.name || '').includes(q));
      if(VIEW_LIST.length===0) showStatus("Ìï¥Îãπ Ï°∞Í±¥Ïóê ÎßûÎäî Ïù¥Î™®ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§."); else hideStatus();
      renderList(VIEW_LIST);
    }

    /* === 6) Î≥µÏÇ¨ === */
    async function copyToClipboard(text){
      try{ await navigator.clipboard.writeText(text); showToast(); }
      catch(_){ UI.copyOut.value=text; UI.copyOut.select(); document.execCommand('copy'); showToast(); }
    }

    /* === 7) Î∂ÄÌä∏Ïä§Ìä∏Îû© === */
    (async function boot(){
      showStatus("Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë‚Ä¶");
      const ok = await loadData();
      if(ok){
        // Ïã§Ï†ú build.json ÏÇ¨Ïö©
        const root = BUILD.items || BUILD.emojis || BUILD.data || BUILD.rows || BUILD;
        ALL_ITEMS = normalizeItems(root);
        CAT_MAP = buildCatMap(ALL_ITEMS);
        buildCategoryTable(CAT_MAP);
        setActiveCategory(ALL_KEY);
      }
    })();

    /* === 8) Ïù¥Î≤§Ìä∏ === */
    UI.search.addEventListener('input', ()=>applySearch());
    UI.grid.addEventListener('click', (e)=>{
      const tile=e.target.closest('.tile'); if(!tile) return;
      const emoji=tile.dataset.emoji || ''; if(!emoji) return;
      UI.copyOut.value=emoji; copyToClipboard(emoji);
    });
    UI.btnCopy.addEventListener('click', ()=>{ const v=UI.copyOut.value||''; if(v) copyToClipboard(v); });
    window.addEventListener('resize', ()=>{ if(!CAT_MAP) return; buildCategoryTable(CAT_MAP); setActiveCategory(ACTIVE_CAT); });
  </script>
</body>
</html>
