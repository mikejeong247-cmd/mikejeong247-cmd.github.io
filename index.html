<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Emoji Site</title>
  <meta name="description" content="Emoji search and copy site" />
  <style>
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;margin:16px}
    .wrap{max-width:1024px;margin:0 auto}

    .topbar{display:grid;grid-template-columns:1fr 220px;gap:12px;align-items:center}
    #q{position:sticky;top:0;z-index:10;background:#fff;width:100%;padding:12px;font-size:16px;border:1px solid #ddd;border-radius:10px}
    #cat{width:100%;padding:12px;font-size:14px;border:1px solid #ddd;border-radius:10px;background:#fff}
    .hint{color:#666;font-size:12px;margin-top:6px}

    /* ğŸ”§ ëª©ë¡/ê·¸ë¦¬ë“œ (ê°„ê²© 0) */
    #grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:0;margin-top:16px}
    .cat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:0}

    /* ğŸ”§ ì¹´ë“œ(ë‘¥ê·¼ ë„¤ëª¨/ë°°ê²½/í…Œë‘ë¦¬/íŒ¨ë”© ì œê±°) */
    .card{cursor:pointer;user-select:none;display:flex;align-items:center;justify-content:center;padding:0;margin:0;background:none;border:none;border-radius:0}

    /* ğŸ”§ ì´ëª¨ì§€ í¬ê¸° (ì›í•˜ë©´ ìˆ«ìë§Œ ë°”ê¾¸ë©´ ë¨) */
    .emoji{font-size:28px;line-height:1.0}

    /* ì´ë¦„ ìˆ¨ê¹€ */
    .name{display:none}

    .toast{position:fixed;right:16px;bottom:16px;background:#222;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transition:opacity .2s}
    .toast.show{opacity:1}
    .err{background:#fff3f3;border:1px solid #ffcccc;color:#b30000;padding:10px;border-radius:10px;margin-top:12px;font-size:13px}

    /* ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ */
    .section{margin-top:28px}
    .section h2{font-size:18px;margin:6px 0 10px 2px}
  </style>

  <!-- âœ… ë‹¤êµ­ì–´ í˜ì´ì§€ ì•Œë¦¼: canonical + hreflang ì„¸íŠ¸ -->
<link rel="canonical" href="https://mikejeong247-cmd.github.io/">

<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=x-default" hreflang="x-default">
<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=en" hreflang="en">
<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=ko" hreflang="ko">
<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=zh-CN" hreflang="zh-CN">
<!-- í•„ìš” ì‹œ ì¶”ê°€
<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=es" hreflang="es">
<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=ja" hreflang="ja">
<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=fr" hreflang="fr">
<link rel="alternate" href="https://mikejeong247-cmd.github.io/?lang=de" hreflang="de">
-->

<meta name="google-site-verification" content="vciw4N79FmEArOFdWHWDeED3fkN_7LEneyOisJGfnhA" />
  
</head>
<body>
  <div class="wrap">
    <h1>ğŸŒ Emoji Site</h1>

    <!-- ê²€ìƒ‰ + ì¹´í…Œê³ ë¦¬ í•„í„° -->
    <div class="topbar">
      <input id="q" type="text" placeholder="ê²€ìƒ‰ / Search (ëª¨ë“  ì–¸ì–´ ì´ë¦„ê³¼ ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰)" />
      <select id="cat">
        <option value="__ALL__">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
      </select>
    </div>
    <div class="hint">ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ì´ëª¨ì§€ê°€ ë³µì‚¬ë©ë‹ˆë‹¤.</div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="grid"></div>      <!-- ê²€ìƒ‰ ê²°ê³¼: í‰í‰ ëª©ë¡ -->
    <div id="sections"></div>  <!-- ê¸°ë³¸: ì¹´í…Œê³ ë¦¬ ê·¸ë£¹ -->
    <div id="error" class="err" style="display:none;"></div>
  </div>

  <div id="toast" class="toast">ğŸ“‹ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</div>

  <script>
    /* ---------- 1) ì–¸ì–´ ìë™ ê²°ì • ---------- */
    function normalizeLocale(l){
      l=(l||"").toLowerCase();
      if(l.startsWith("zh-cn")||l==="zh-hans") return "zh-CN";
      if(l.startsWith("zh-tw")||l==="zh-hant") return "zh-TW";
      if(l.startsWith("ko")) return "ko";
      if(l.startsWith("en")) return "en";
      if(l.startsWith("es")) return "es";
      if(l.startsWith("zh")) return "zh";
      if(l.startsWith("ja")) return "ja";
      if(l.startsWith("fr")) return "fr";
      if(l.startsWith("de")) return "de";
      if(l.startsWith("pt")) return "pt";
      if(l.startsWith("ru")) return "ru";
      if(l.startsWith("ar")) return "ar";
      return "en";
    }
    const urlParams=new URLSearchParams(window.location.search);
    const urlLang=urlParams.get("lang");
    const browserLangs=(navigator.languages&&navigator.languages.length)?navigator.languages:[navigator.language||"en"];
    const lang=urlLang?normalizeLocale(urlLang):normalizeLocale(browserLangs[0]);
    document.documentElement.lang=lang;
    window.__LANG__=lang;

    /* ---------- 2) êµ¬ê¸€ì‹œíŠ¸ CSV ì£¼ì†Œ ---------- */
    const DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT_RAfp9VnhQCpOkq9fBnu3b44r6jTB9EyT4qefGNSOf7R0SKuvEt_OvFs_qHLFQA9a3VRade4mxsjA/pub?gid=1007324268&single=true&output=csv";

    /* ---------- 3) CSV íŒŒì„œ ---------- */
    function parseCSV(text){
      const rows=[]; let cur=[],val="",inQ=false;
      for(let i=0;i<text.length;i++){
        const c=text[i], n=text[i+1];
        if(c==='\"'){ if(inQ&&n==='\"'){ val+='\"'; i++; } else inQ=!inQ; }
        else if(c===','&&!inQ){ cur.push(val); val=""; }
        else if((c==='\n'||c==='\r')&&!inQ){ if(val!==""||cur.length){ cur.push(val); rows.push(cur); cur=[]; val=""; } if(c==='\r'&&n==='\n') i++; }
        else{ val+=c; }
      }
      if(val!==""||cur.length){ cur.push(val); rows.push(cur); }
      return rows;
    }
    function csvToObjects(text){
      const arr=parseCSV(text).filter(r=>r.length&&r.some(x=>x!==""));
      const headers=arr[0].map(h=>h.trim());
      return arr.slice(1).map(cols=>{
        const o={}; headers.forEach((h,i)=>o[h]=(cols[i]||"").trim()); return o;
      });
    }

    /* ---------- 4) í—¬í¼ë“¤ ---------- */
    function codeToEmoji(code){
      const hex=(code||"").replace(/U\+/i,"").trim();
      return hex ? String.fromCodePoint(parseInt(hex,16)) : "";
    }
    function getEmojiName(row){
      const lang=window.__LANG__;
      const prefs=[];
      prefs.push(`Name_${lang}`);
      if(lang==="zh") prefs.push("Name_zh","Name_zh-CN","Name_zh-TW","Name_zh_Hans","Name_zh_Hant");
      if(lang==="zh-CN") prefs.push("Name_zh-CN","Name_zh");
      if(lang==="zh-TW") prefs.push("Name_zh-TW","Name_zh");
      prefs.push("Name_ko","Name_en");
      for(const k of prefs){ if(k in row && row[k]) return row[k]; }
      return row["Name"] || "";
    }
    function allNamesLower(row){
      const parts=[];
      for(const k in row){
        if(/^Name($|_)/i.test(k) && row[k]) parts.push(String(row[k]).toLowerCase());
      }
      if(row.Category) parts.push(String(row.Category).toLowerCase());
      return parts.join(" | ");
    }
    function toast(msg="ğŸ“‹ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤"){
      const t=document.getElementById("toast");
      t.textContent=msg; t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"),1400);
    }
    function cardHTML(r){
      const emoji=codeToEmoji(r.Code || r.code || r.CODE);
      const name=getEmojiName(r);
      const copy=emoji.replace(/'/g,"\\'");
      return `
        <div class="card" onclick="navigator.clipboard.writeText('${copy}').then(()=>toast('ë³µì‚¬ë¨: ${copy}'))" title="${name}">
          <div class="emoji">${emoji}</div>
          <div class="name">${name}</div>
        </div>`;
    }

    /* ---------- 5) ë Œë”ë§ ---------- */
    function renderFlat(data){ // ê²€ìƒ‰ ëª¨ë“œ
      document.getElementById("sections").innerHTML = "";
      document.getElementById("grid").innerHTML = data.map(cardHTML).join("") || `<div style="color:#666;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    }

    // âœ… ë”ë³´ê¸° ì—†ì´ ì „ë¶€ í‘œì‹œ / ê°„ê²© 0 / ì¹´ë“œ í…Œë‘ë¦¬ ì œê±° ë°˜ì˜
    function renderGrouped(data, onlyCategory="__ALL__"){
      const byCat = {};
      data.forEach(r=>{
        const c = r.Category && r.Category.trim() ? r.Category.trim() : "(Uncategorized)";
        if(!byCat[c]) byCat[c]=[];
        byCat[c].push(r);
      });
      const cats = Object.keys(byCat).sort((a,b)=>a.localeCompare(b));

      let html = "";
      cats.forEach(cat=>{
        if(onlyCategory!=="__ALL__" && cat!==onlyCategory) return;
        const rows = byCat[cat];
        html += `
          <section class="section" data-cat="${cat}">
            <h2>${cat} <span style="color:#999;font-weight:400">(${rows.length})</span></h2>
            <div class="cat-grid">${rows.map(cardHTML).join("")}</div>
          </section>
        `;
      });

      document.getElementById("sections").innerHTML = html || `<div style="color:#666;margin-top:12px;">í‘œì‹œí•  ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      document.getElementById("grid").innerHTML = "";
    }

    /* ---------- 6) ë©”ì¸ ë¡œì§ ---------- */
    let ROWS=[];
    const $q = document.getElementById("q");
    const $cat = document.getElementById("cat");

    $q.addEventListener("input", applyView);
    $cat.addEventListener("change", applyView);

    function applyView(){
      const q = $q.value.trim().toLowerCase();
      const catVal = $cat.value;

      if(q){ // ê²€ìƒ‰ ëª¨ë“œ
        let filtered = ROWS.filter(r=>{
          const curName=(getEmojiName(r)||"").toLowerCase();
          const allNames=allNamesLower(r);
          const catOk = (catVal==="__ALL__") ? true : (String(r.Category||"").trim()===catVal);
          return catOk && (curName.includes(q) || allNames.includes(q));
        });
        filtered.sort((a,b)=>{
          const aCur=(getEmojiName(a)||"").toLowerCase();
          const bCur=(getEmojiName(b)||"").toLowerCase();
          const aMatch=aCur.includes(q);
          const bMatch=bCur.includes(q);
          if(aMatch && !bMatch) return -1;
          if(!aMatch && bMatch) return 1;
          return 0;
        });
        renderFlat(filtered);
      } else { // ê·¸ë£¹ ëª¨ë“œ
        const data = (catVal==="__ALL__") ? ROWS : ROWS.filter(r => String(r.Category||"").trim()===catVal);
        renderGrouped(data, catVal);
      }
    }

    async function load(){
      try{
        const res=await fetch(DATA_URL);
        if(!res.ok) throw new Error("CSV ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: "+res.status);
        const text=await res.text();
        ROWS=csvToObjects(text);

        // ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
        const cats = Array.from(new Set(ROWS.map(r => (r.Category||"").trim()).filter(Boolean))).sort((a,b)=>a.localeCompare(b));
        const opts = ['<option value="__ALL__">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>'].concat(cats.map(c=>`<option value="${c}">${c}</option>`));
        document.getElementById("cat").innerHTML = opts.join("");

        applyView(); // ì²« ë Œë”
      }catch(e){
        console.error(e);
        const err=document.getElementById("error");
        err.style.display="block";
        err.innerHTML="ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. <br>1) ìŠ¤í”„ë ˆë“œì‹œíŠ¸ â€˜íŒŒì¼ â†’ ì›¹ì— ê²Œì‹œ(CSV)â€™ì¸ì§€ í™•ì¸ <br>2) DATA_URL ì£¼ì†Œ í™•ì¸ <br>3) ì²« í–‰ í—¤ë”ê°€ Code, Category, Name_en, Name_ko, ... ì¸ì§€ í™•ì¸";
      }
    }
    load();
  </script>
</body>
</html>
