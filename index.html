<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Emoji Site</title>
  <meta name="description" content="Emoji search and copy site" />
  <style>
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;margin:16px}
    .wrap{max-width:1024px;margin:0 auto}
    .langbar{margin:8px 0 12px}
    .langbar a{margin-right:8px;text-decoration:none}
    #q{position:sticky;top:0;z-index:10;background:#fff;width:100%;padding:12px;font-size:16px;border:1px solid #ddd;border-radius:10px}
    #grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px;margin-top:16px}
    .card{border:1px solid #eee;border-radius:12px;padding:12px;text-align:center;cursor:pointer;user-select:none}
    .emoji{font-size:38px;line-height:1.2}
    .name{font-size:12px;color:#666;margin-top:8px}
    .hint{color:#666;font-size:12px;margin-top:6px}
    .toast{position:fixed;right:16px;bottom:16px;background:#222;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transition:opacity .2s}
    .toast.show{opacity:1}
    .err{background:#fff3f3;border:1px solid #ffcccc;color:#b30000;padding:10px;border-radius:10px;margin-top:12px;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸŒ Emoji Site</h1>
    <p>ì´ í˜ì´ì§€ëŠ” ì–¸ì–´ íŒŒë¼ë¯¸í„°ë¡œ ë‹¤êµ­ì–´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ì£¼ì†Œ ë’¤ì— <code>?lang=ko</code>, <code>?lang=en</code>, <code>?lang=zh</code> ë“±ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</p>

    <!-- ì–¸ì–´ ìŠ¤ìœ„ì¹˜ -->
    <div class="langbar">
      <strong>Language:</strong>
      <a href="?lang=ko">í•œêµ­ì–´</a>
      <a href="?lang=en">English</a>
      <a href="?lang=es">EspaÃ±ol</a>
      <a href="?lang=zh">ä¸­æ–‡(zh)</a>
      <a href="?lang=zh-CN">ä¸­æ–‡(ç®€ä½“ zh-CN)</a>
      <a href="?lang=zh-TW">ä¸­æ–‡(ç¹é«” zh-TW)</a>
      <a href="?lang=ja">æ—¥æœ¬èª</a>
      <a href="?lang=fr">FranÃ§ais</a>
      <a href="?lang=de">Deutsch</a>
    </div>

    <!-- ê²€ìƒ‰ì°½ & ê·¸ë¦¬ë“œ -->
    <input id="q" type="text" placeholder="ê²€ìƒ‰ / Search" />
    <div class="hint">ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ì´ëª¨ì§€ê°€ ë³µì‚¬ë©ë‹ˆë‹¤.</div>
    <div id="grid"></div>
    <div id="error" class="err" style="display:none;"></div>
  </div>
  
  <div id="toast" class="toast">ğŸ“‹ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</div>

  <script>
    // 1) URLì—ì„œ lang ì½ê¸° + <html lang> ì„¤ì •
    const urlParams = new URLSearchParams(window.location.search);
    const langParam = urlParams.get("lang") || "en";
    document.documentElement.lang = langParam;

    // 2) === ì—¬ê¸°ì— ìŠ¤í”„ë ˆë“œì‹œíŠ¸ CSV ì£¼ì†Œë§Œ ë¶™ì—¬ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤ ===
    // ì˜ˆ) https://docs.google.com/spreadsheets/d/ìŠ¤í”„ë ˆë“œì‹œíŠ¸ID/export?format=csv&gid=ì‹œíŠ¸GID
    const DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT_RAfp9VnhQCpOkq9fBnu3b44r6jTB9EyT4qefGNSOf7R0SKuvEt_OvFs_qHLFQA9a3VRade4mxsjA/pub?gid=1007324268&single=true&output=csv";

    // 3) CSV íŒŒì„œ (ë”°ì˜´í‘œ/ì½¤ë§ˆ í¬í•¨ ê¸°ë³¸ ëŒ€ì‘)
    function parseCSV(text){
      const rows=[]; let cur=[],val="",inQ=false;
      for(let i=0;i<text.length;i++){
        const c=text[i], n=text[i+1];
        if(c==='\"'){
          if(inQ && n==='\"'){ val+='\"'; i++; }
          else inQ=!inQ;
        }else if(c===',' && !inQ){ cur.push(val); val=""; }
        else if((c==='\n'||c==='\r') && !inQ){
          if(val!==""||cur.length){ cur.push(val); rows.push(cur); cur=[]; val=""; }
          if(c==='\r' && n==='\n') i++;
        }else{ val+=c; }
      }
      if(val!==""||cur.length){ cur.push(val); rows.push(cur); }
      return rows;
    }
    function csvToObjects(text){
      const arr=parseCSV(text).filter(r=>r.length&&r.some(x=>x!==""));
      const headers=arr[0].map(h=>h.trim());
      return arr.slice(1).map(cols=>{
        const o={}; headers.forEach((h,i)=>o[h]=(cols[i]||"").trim()); return o;
      });
    }

    // 4) ìœ ë‹ˆì½”ë“œ í¬ì¸íŠ¸ â†’ ì´ëª¨ì§€
    function codeToEmoji(code){
      const hex=(code||"").replace(/U\+/i,"").trim();
      return hex ? String.fromCodePoint(parseInt(hex,16)) : "";
    }

    // 5) í˜„ì¬ ì–¸ì–´ ì´ë¦„ ë°˜í™˜ (ë‹¤ì–‘í•œ ì¤‘êµ­ì–´ ì»¬ëŸ¼ ëŒ€ì‘ + í´ë°±)
    function getEmojiName(row){
      // ìš°ì„ ìˆœìœ„ ë°°ì—´ì„ ë§Œë“¤ì–´ì„œ ì²« ë²ˆì§¸ë¡œ ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ ì‚¬ìš©
      const prefs = [];
      // langParam ê·¸ëŒ€ë¡œ ì‹œë„ (ì˜ˆ: Name_zh-CN)
      prefs.push(`Name_${langParam}`);
      // zh ê³„ì—´ ë³´ì¡° ë§µí•‘
      if(langParam === "zh") prefs.push("Name_zh","Name_zh-CN","Name_zh-TW","Name_zh_Hans","Name_zh_Hant");
      if(langParam === "zh-CN") prefs.push("Name_zh-CN","Name_zh");
      if(langParam === "zh-TW") prefs.push("Name_zh-TW","Name_zh");
      // ì¼ë°˜ í´ë°±
      prefs.push("Name_ko","Name_en"); // ko â†’ en ìˆœì„œë¡œ ì‹œë„ (ì›í•˜ì‹œë©´ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥)

      for(const k of prefs){
        if(k in row && row[k]) return row[k];
      }
      // ë§ˆì§€ë§‰ ìµœí›„ì˜ í´ë°±
      return row["Name"] || "";
    }

    // 6) í† ìŠ¤íŠ¸
    function toast(msg="ğŸ“‹ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤"){
      const t=document.getElementById("toast");
      t.textContent=msg; t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"),1400);
    }

    // 7) ë Œë”ë§
    function renderGrid(data){
      const q=document.getElementById("q").value.trim().toLowerCase();
      const filtered=data.filter(r=>{
        const name=(getEmojiName(r)||"").toLowerCase();
        return !q || name.includes(q);
      });

      const html=filtered.map(r=>{
        const emoji=codeToEmoji(r.Code || r.code || r.CODE);
        const name=getEmojiName(r);
        const copy=emoji.replace(/'/g,"\\'");
        return `
          <div class="card" onclick="navigator.clipboard.writeText('${copy}').then(()=>toast('ë³µì‚¬ë¨: ${copy}'))">
            <div class="emoji">${emoji}</div>
            <div class="name">${name}</div>
          </div>`;
      }).join("");

      document.getElementById("grid").innerHTML = html || `<div style="color:#666;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    }

    // 8) ë¡œë“œ & ì´ë²¤íŠ¸
    let ROWS=[];
    document.getElementById("q").addEventListener("input",()=>renderGrid(ROWS));

    async function load(){
      try{
        const res=await fetch(DATA_URL);
        if(!res.ok) throw new Error("CSV ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: "+res.status);
        const text=await res.text();
        ROWS=csvToObjects(text);
        renderGrid(ROWS);
      }catch(e){
        console.error(e);
        const err=document.getElementById("error");
        err.style.display="block";
        err.innerHTML="ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. <br>1) ìŠ¤í”„ë ˆë“œì‹œíŠ¸ â€˜íŒŒì¼ â†’ ì›¹ì— ê²Œì‹œâ€™(CSV)ì¸ì§€ í™•ì¸ <br>2) DATA_URL ì£¼ì†Œê°€ ë§ëŠ”ì§€ í™•ì¸ <br>3) ì²« í–‰ í—¤ë”ê°€ Code, Name_en, Name_ko, Name_es, Name_zh-CN ë“±ì¸ì§€ í™•ì¸";
      }
    }
    load();
  </script>
</body>
</html>
